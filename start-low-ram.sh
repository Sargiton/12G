#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ —Å 1 –ì–ë RAM
echo "üöÄ –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–π RAM..."

# –°–æ–∑–¥–∞–µ–º –ø–∞–ø–∫—É –¥–ª—è –ª–æ–≥–æ–≤
mkdir -p logs

# –û—á–∏—â–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
echo "üßπ –û—á–∏—Å—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤..."
rm -rf tmp/*
rm -rf storage/media-cache/*

# –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã PM2
echo "‚èπÔ∏è –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤..."
pm2 stop all 2>/dev/null || true
pm2 delete all 2>/dev/null || true

# –û—á–∏—â–∞–µ–º –∫—ç—à Node.js
echo "üßπ –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ Node.js..."
node --max-old-space-size=256 -e "if (global.gc) global.gc()" 2>/dev/null || true

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–≤–æ–±–æ–¥–Ω—É—é –ø–∞–º—è—Ç—å
echo "üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞–º—è—Ç–∏:"
free -h

# –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç—ã —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏ –ø–∞–º—è—Ç–∏
echo "üöÄ –ó–∞–ø—É—Å–∫ WhatsApp –±–æ—Ç–∞..."
pm2 start ecosystem-low-ram.config.js --only whatsapp-bot

# –ñ–¥–µ–º –Ω–µ–º–Ω–æ–≥–æ
sleep 5

echo "üöÄ –ó–∞–ø—É—Å–∫ Telegram –±–æ—Ç–∞..."
pm2 start ecosystem-low-ram.config.js --only telegram-bot

# –ñ–¥–µ–º –∑–∞–ø—É—Å–∫–∞
sleep 10

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å
echo "üìä –°—Ç–∞—Ç—É—Å –ø—Ä–æ—Ü–µ—Å—Å–æ–≤:"
pm2 list

echo "üìä –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏:"
pm2 monit --no-daemon &
MONIT_PID=$!

# –ñ–¥–µ–º 30 —Å–µ–∫—É–Ω–¥ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
sleep 30

# –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
kill $MONIT_PID 2>/dev/null || true

echo "‚úÖ –ë–æ—Ç—ã –∑–∞–ø—É—â–µ–Ω—ã —Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π –¥–ª—è –Ω–∏–∑–∫–æ–π RAM!"
echo "üì± –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–º–∞–Ω–¥—ã –≤ Telegram: /help_me, /quick_check"
