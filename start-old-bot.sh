#!/bin/bash

set -e

cd "$(dirname "$0")"

echo "üîß –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å—Ç–∞—Ä–æ–≥–æ –±–æ—Ç–∞ (–ø–∞–ø–∫–∞ 123)"

# –°–æ–∑–¥–∞–µ–º –∫–∞—Ç–∞–ª–æ–≥ –ª–æ–≥–æ–≤
mkdir -p 123/logs

echo "üõë –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é –≤–æ–∑–º–æ–∂–Ω—ã–µ –∑–∞–ø—É—â–µ–Ω–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã whatsapp-old"
pm2 delete whatsapp-old || true

echo "üì¶ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è —Å—Ç–∞—Ä–æ–≥–æ –±–æ—Ç–∞"
cd 123
npm install --production || npm install

echo "‚¨ÖÔ∏è –í–æ–∑–≤—Ä–∞—â–∞—é—Å—å –≤ –∫–æ—Ä–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞"
cd ..

echo "üöÄ –ó–∞–ø—É—Å–∫–∞—é whatsapp-old —á–µ—Ä–µ–∑ PM2"
pm2 start ecosystem-old.config.cjs

echo "üíæ –°–æ—Ö—Ä–∞–Ω—è—é PM2"
pm2 save

echo "üìã –õ–æ–≥–∏ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 20 —Å—Ç—Ä–æ–∫):"
pm2 logs whatsapp-old --lines 20

echo "‚úÖ –ì–æ—Ç–æ–≤–æ. –ë–æ—Ç –∏–∑ –ø–∞–ø–∫–∏ 123 –∑–∞–ø—É—â–µ–Ω –∫–∞–∫ whatsapp-old"


